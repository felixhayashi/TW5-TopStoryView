/*\
title: $:/plugins/felixhayashi/topstoryview/top.js
type: application/javascript
module-type: storyview

Views the story as a linear sequence

@preserve

\*/
(function(){"use strict";var t="cubic-bezier(0.645, 0.045, 0.355, 1)";var i=function(t){this.listWidget=t;this.pageScroller=new $tw.utils.PageScroller;this.pageScroller.scrollIntoView=this.scrollIntoView;this.pageScroller.storyRiverElement=document.getElementsByClassName("tc-story-river")[0];var i=$tw.wiki.getTiddler("$:/config/storyRiver/top/scrollOffset");this.pageScroller.offsetTop=i?parseInt(i.fields.text):71};i.prototype.navigateTo=function(t){var i=this.listWidget.findListItem(0,t.title);if(i===undefined){return}var e=this.listWidget.children[i],o=e.findFirstDomNode();if(o instanceof Element){this.pageScroller.scrollIntoView(o)}};i.prototype.scrollIntoView=function(t){var i=$tw.utils.getAnimationDuration();this.cancelScroll();this.startTime=Date.now();var e=$tw.utils.getScrollPosition();var o=t.getBoundingClientRect(),n={left:o.left+e.x,top:o.top+e.y,width:o.width,height:o.height};var r=function(t,i,e,o){if(t<=e){return t}else if(i<o&&e<t+i-o){return t+i-o}else if(e<t){return t}else{return e}},s=r(n.left,n.width,e.x,window.innerWidth),a=n.top-this.offsetTop;if(s!==e.x||a!==e.y){var l=this,m;m=function(){var t;if(i<=0){t=1}else{t=(Date.now()-l.startTime)/i}if(t>=1){l.cancelScroll();t=1}t=$tw.utils.slowInSlowOut(t);window.scrollTo(e.x+(s-e.x)*t,e.y+(a-e.y)*t);if(t<1){l.idRequestFrame=l.requestAnimationFrame.call(window,m)}};m()}};i.prototype.insert=function(i){var e=i.findFirstDomNode(),o=$tw.utils.getAnimationDuration();if(!(e instanceof Element)){return}var n=window.getComputedStyle(e),r=parseInt(n.marginBottom,10),s=parseInt(n.marginTop,10),a=e.offsetHeight+s;setTimeout(function(){$tw.utils.setStyle(e,[{transition:"none"},{marginBottom:""}])},o);$tw.utils.setStyle(e,[{transition:"none"},{marginBottom:-a+"px"},{opacity:"0.0"}]);$tw.utils.forceLayout(e);$tw.utils.setStyle(e,[{transition:"opacity "+o+"ms "+t+", "+"margin-bottom "+o+"ms "+t},{marginBottom:r+"px"},{opacity:"1.0"}])};i.prototype.remove=function(i){var e=i.findFirstDomNode(),o=$tw.utils.getAnimationDuration(),n=function(){i.removeChildDomNodes()};if(!(e instanceof Element)){n();return}var r=e.offsetWidth,s=window.getComputedStyle(e),a=parseInt(s.marginBottom,10),l=parseInt(s.marginTop,10),m=e.offsetHeight+l;setTimeout(n,o);$tw.utils.setStyle(e,[{transition:"none"},{transform:"translateX(0px)"},{marginBottom:a+"px"},{opacity:"1.0"}]);$tw.utils.forceLayout(e);$tw.utils.setStyle(e,[{transition:$tw.utils.roundTripPropertyName("transform")+" "+o+"ms "+t+", "+"opacity "+o+"ms "+t+", "+"margin-bottom "+o+"ms "+t},{transform:"translateX(-"+r+"px)"},{marginBottom:-m+"px"},{opacity:"0.0"}])};exports.top=i})();