/*\
title: $:/plugins/felixhayashi/topstoryview/top.js
type: application/javascript
module-type: storyview

Views the story as a linear sequence

@preserve

\*/
(function(){"use strict";var t=require("$:/plugins/felixhayashi/topstoryview/config.js").config;var i="cubic-bezier(0.645, 0.045, 0.355, 1)";var e=function(i){this.listWidget=i;this.pageScroller=new $tw.utils.PageScroller;this.pageScroller.scrollIntoView=this.scrollIntoView;this.pageScroller.storyRiverElement=document.getElementsByClassName(t.classNames.storyRiver)[0];var e=$tw.wiki.getTiddler(t.references.scrollOffsetStore);this.pageScroller.offsetTop=e?parseInt(e.fields.text):71};e.prototype.navigateTo=function(t){var i=this.listWidget.findListItem(0,t.title);if(i===undefined){return}var e=this.listWidget.children[i],o=e.findFirstDomNode();if(o instanceof Element){this.pageScroller.scrollIntoView(o)}};e.prototype.scrollIntoView=function(t){var i=$tw.utils.getAnimationDuration();this.cancelScroll();this.startTime=Date.now();var e=$tw.utils.getScrollPosition();var o=t.getBoundingClientRect(),r={left:o.left+e.x,top:o.top+e.y,width:o.width,height:o.height};var n=function(t,i,e,o){if(t<=e){return t}else if(i<o&&e<t+i-o){return t+i-o}else if(e<t){return t}else{return e}},s=n(r.left,r.width,e.x,window.innerWidth),l=r.top-this.offsetTop;if(s!==e.x||l!==e.y){var a=this,c;c=function(){var t;if(i<=0){t=1}else{t=(Date.now()-a.startTime)/i}if(t>=1){a.cancelScroll();t=1}t=$tw.utils.slowInSlowOut(t);window.scrollTo(e.x+(s-e.x)*t,e.y+(l-e.y)*t);if(t<1){a.idRequestFrame=a.requestAnimationFrame.call(window,c)}};c()}};e.prototype.startZeroScroll=function(){var t=$tw.utils.getScrollPosition();window.scrollTo(t.x,t.y+1);window.scrollTo(t.x,t.y)};e.prototype.insert=function(t){var e=t.findFirstDomNode(),o=$tw.utils.getAnimationDuration();if(!(e instanceof Element)){return}var r=window.getComputedStyle(e),n=parseInt(r.marginBottom,10),s=parseInt(r.marginTop,10),l=e.offsetHeight+s;setTimeout(function(){$tw.utils.setStyle(e,[{transition:"none"},{marginBottom:""}]);this.startZeroScroll()}.bind(this),o);$tw.utils.setStyle(e,[{transition:"none"},{marginBottom:-l+"px"},{opacity:"0.0"}]);$tw.utils.forceLayout(e);$tw.utils.setStyle(e,[{transition:"opacity "+o+"ms "+i+", "+"margin-bottom "+o+"ms "+i},{marginBottom:n+"px"},{opacity:"1.0"}])};e.prototype.remove=function(t){var e=t.findFirstDomNode(),o=$tw.utils.getAnimationDuration(),r=function(){t.removeChildDomNodes();this.startZeroScroll()}.bind(this);if(!(e instanceof Element)){r();return}var n=e.offsetWidth,s=window.getComputedStyle(e),l=parseInt(s.marginBottom,10),a=parseInt(s.marginTop,10),c=e.offsetHeight+a;setTimeout(r,o);$tw.utils.setStyle(e,[{transition:"none"},{transform:"translateX(0px)"},{marginBottom:l+"px"},{opacity:"1.0"}]);$tw.utils.forceLayout(e);$tw.utils.setStyle(e,[{transition:$tw.utils.roundTripPropertyName("transform")+" "+o+"ms "+i+", "+"opacity "+o+"ms "+i+", "+"margin-bottom "+o+"ms "+i},{transform:"translateX(-"+n+"px)"},{marginBottom:-c+"px"},{opacity:"0.0"}])};exports.top=e})();